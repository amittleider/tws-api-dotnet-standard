<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>TWS API v9.72+: Profit And Loss (P&amp;L)</title>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="https://www.interactivebrokers.com/favicon.ico" rel="shortcut icon">
<script>
$(document).ready(function(){
		var picked=getCookie("picked");
		if (picked != "") {
			if (!$(this).hasClass("active")) {
				var tabNum = $(this).index();
				var nthChild = picked;
				$("ul#tabs li.active").removeClass("active");
				$(this).addClass("active");
				$("ul#tab li.active").removeClass("active");
				$("ul#tab li:nth-child("+nthChild+")").addClass("active");
				$("ul#tabs li:nth-child("+nthChild+")").addClass("active");
				setCookie("picked", nthChild, 1);
			}
		}
		$("ul#tabs li").click(function(e){
			if (!$(this).hasClass("active")) {
			var tabNum = $(this).index();
			var nthChild = tabNum+1;
			$("ul#tabs li.active").removeClass("active");
			$(this).addClass("active");
			$("ul#tab li.active").removeClass("active");
			$("ul#tab li:nth-child("+nthChild+")").addClass("active");
			setCookie("picked", nthChild, 1);
		}
    });
});
function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires="+d.toUTCString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
} 
function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i=0; i<ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1);
        if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
    }
    return "";
} 
function checkCookie() {
    var picked=getCookie("picked");
    if (picked != "") {
        alert("Welcome again " + picked);
    }else{
        //username = prompt("Please enter your name:", "");
        if (picked != "" && picked != null) {
            setCookie("picked", 1, 365);
        }
    }
}
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ib_theme.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" style="background-color:black;">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr>
  <td id="projectlogo"><img alt="Logo" src="nav_iblogo.png"/></a></td>
  <td style="padding: 0 0 0 1em;">
   <ul id="tabs"><li class="active">C#</li><li>Java</li><li>VB</li><li>C++</li><li>Python</li></ul>
  </td>
  <td><a href="https://www.interactivebrokers.com/en/index.php?f=customerService&p=email" style="color:#C7C7C7;font-weight:bold;padding: 0 0 0 1em;">Contact us</a></td>
  <!--BEGIN GCS_SEARCHBOX-->
  <td style="position: absolute; right: 0;">
   <div id="google-custom-search" align="right" style="vertical-align: top;">
   <script>
  (function() {
    var cx = '015239726745168389685:6_uymb577ei';
	var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
	</script>
	<gcse:search newWindow="false" enableHistory="true"></gcse:search>
   </div>
   </td>
  <!--END !GCS_SEARCHBOX-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('pnl.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Profit And Loss (P&amp;L) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="account_window_pnl"></a>
P&amp;L data in the Account Window</h1>
<p>UnRealized and Realized P&amp;L is sent to the API function <a class="el" href="interfaceIBApi_1_1EWrapper.html#ae15a34084d9f26f279abd0bdeab1b9b5" title="Receives the subscribed account&#39;s information. Only one account can be subscribed at a time...">IBApi.EWrapper.updateAccountValue</a> function after a subscription request is made with <a class="el" href="classIBApi_1_1EClient.html#aea1b0d9b6b85a4e0b18caf13a51f837f" title="Subscribes to an specific account&#39;s information and portfolio Through this method, a single account&#39;s subscription can be started/stopped. As a result from the subscription, the account&#39;s information, portfolio and last update time will be received at EWrapper::updateAccountValue, EWrapper::updateAccountPortfolio, EWrapper::updateAccountTime respectively. All account values and positions will be returned initially, and then there will only be updates when there is a change in a position, or to an account value every 3 minutes if it has changed. Only one account can be subscribed at a time. A second subscription request for another account when the previous one is still active will cause the first one to be canceled in favour of the second one. Consider user reqPositions if you want to retrieve all your accounts&#39; portfolios directly. ">IBApi.EClient.reqAccountUpdates</a>. This information corresponds to the data in the TWS Account Window, and has a different source of information, a different update frequency, and different reset schedule than PnL data in the TWS Portfolio Window and associated API functions (below). In particular, the unrealized P&amp;L information shown in the TWS Account Window which is sent to updatePortfolioValue will update either <b>(1)</b> when a trade for that particular instrument occurs or <b>(2)</b> every 3 mintues. The realized P&amp;L data in the TWS <a href="https://www.interactivebrokers.com/en/software/tws/usersguidebook/realtimeactivitymonitoring/the_account_window.htm" target="_blank">Account Window</a> is reset to 0 once per day.</p>
<ul>
<li>It is important to keep in mind that the P&amp;L data shown in the Account Window and Portfolio Window will sometimes differ because there is a different source of information and a different reset schedule.</li>
</ul>
<h1><a class="anchor" id="portfolio_window_pnl"></a>
P&amp;L data in the Portfolio Window</h1>
<p>Beginning with API v973.03, requests can be made to receive real time updates about the daily P&amp;L and unrealized P&amp;L for an account, or for individual positions. Financial Advisors can also request P&amp;L figures for a FA group, or portfolio model. In API v973.05+/TWS v968+ this is further extended to include realized P&amp;L information at the account or individual position level.</p>
<ul>
<li>Note in Python the P&amp;L functions are available starting in v973.05.</li>
</ul>
<p>These newer P&amp;L API functions demonstrated below return the data which is displayed in the TWS <a href="https://www.interactivebrokers.com/en/software/tws/usersguidebook/realtimeactivitymonitoring/profitloss.htm" target="_blank">Portfolio Window</a> in current versions of TWS (v963+). As such, the P&amp;L values are calculated based on the reset schedule specifed in TWS Global Configuration (by default an instrument-specific reset schedule) and this setting affects values sent to the associated API functions as well. Also in TWS, P&amp;L data from virtual forex positions will be included in the account P&amp;L if and only if the Virtual Fx section of the Account Window is expanded.</p>
<h2>P&amp;L subscription requests for individual positions</h2>
<p>Subscribe using the <a class="el" href="classIBApi_1_1EClient.html#a9ba0dc47f80ff9e836a235a0dea791b3" title="Requests real time updates for daily PnL of individual positions. ">IBApi::EClient::reqPnLSingle</a> function</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">            client.reqPnLSingle(17001, <span class="stringliteral">&quot;DUD00029&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 268084);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        client.reqPnLSingle(17001, <span class="stringliteral">&quot;DUD00029&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 268084);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        client.reqPnLSingle(17001, <span class="stringliteral">&quot;DUD00029&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 268084)</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    m_pClient-&gt;reqPnLSingle(7002, <span class="stringliteral">&quot;DUD00029&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 268084);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"></div><!-- fragment -->  </li>
</ul>
<p>Currently updates are returned to <a class="el" href="interfaceIBApi_1_1EWrapper.html#aebeb008f2b763d7bed2969b66bbd1b33" title="receives real time updates for single position daily PnL values ">IBApi.EWrapper.pnlSingle</a> approximately once per second. *subject to change in the future</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> pnlSingle(<span class="keywordtype">int</span> reqId, <span class="keywordtype">int</span> pos, <span class="keywordtype">double</span> dailyPnL, <span class="keywordtype">double</span> unrealizedPnL, <span class="keywordtype">double</span> realizedPnL, <span class="keywordtype">double</span> value)</div>
<div class="line">        {</div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;PnL Single. Request Id: {0}, Pos {1}, Daily PnL {2}, Unrealized PnL {3}, Realized PnL: {4}, Value: {5}&quot;</span>, reqId, pos, dailyPnL, unrealizedPnL, realizedPnL, value);</div>
<div class="line">        }</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    @Override</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> pnlSingle(<span class="keywordtype">int</span> reqId, <span class="keywordtype">int</span> pos, <span class="keywordtype">double</span> dailyPnL, <span class="keywordtype">double</span> unrealizedPnL, <span class="keywordtype">double</span> realizedPnL, <span class="keywordtype">double</span> value) {</div>
<div class="line">        System.out.println(EWrapperMsgGenerator.pnlSingle(reqId, pos, dailyPnL, unrealizedPnL, realizedPnL, value));                </div>
<div class="line">    }</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        Public Sub pnlSingle(reqId As Integer, pos As Integer, dailyPnL As Double, unrealizedPnL As Double, realizedPnL As Double, value As Double) Implements EWrapper.pnlSingle</div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;PnL Single. Request Id: {0}, pos: {1}, daily PnL: {2}, unrealized PnL: {3}, realized PnL: {4}, value: {5}&quot;</span>, reqId, pos, dailyPnL, unrealizedPnL, realizedPnL, value)</div>
<div class="line">        End Sub</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> TestCppClient::pnlSingle(<span class="keywordtype">int</span> reqId, <span class="keywordtype">int</span> pos, <span class="keywordtype">double</span> dailyPnL, <span class="keywordtype">double</span> unrealizedPnL, <span class="keywordtype">double</span> realizedPnL, <span class="keywordtype">double</span> value) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;PnL Single. ReqId: %d, pos: %d, daily PnL: %g, unrealized PnL: %g, realized PnL: %g, value: %g\n&quot;</span>, reqId, pos, dailyPnL, unrealizedPnL, realizedPnL, value);</div>
<div class="line">}</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"></div><!-- fragment -->  </li>
</ul>
<ul>
<li>If a P&amp;L subscription request is made for an invalid conId or contract not in the account, there will not be a response.</li>
<li>As elsewhere in the API, a max double value will indicate an 'unset' value. This corresponds to an empty cell in TWS.</li>
</ul>
<p>Subscriptions are cancelled using the <a class="el" href="classIBApi_1_1EClient.html#accd383725ef440070775654a9ab4bf47" title="Cancels real time subscription for a positions daily PnL information. ">IBApi::EClient::cancelPnLSingle</a> function:</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">            client.cancelPnLSingle(17001);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        client.cancelPnLSingle(17001);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        client.cancelPnLSingle(17001)</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    m_pClient-&gt;cancelPnLSingle(7002);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"></div><!-- fragment -->  </li>
</ul>
<h2>P&amp;L subscription requests for accounts</h2>
<p>Subscribe using the <a class="el" href="classIBApi_1_1EClient.html#a0351f22a77b5ba0c0243122baf72fa45" title="Creates subscription for real time daily PnL and unrealized PnL updates. ">IBApi::EClient::reqPnL</a> function:</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">            client.reqPnL(17001, <span class="stringliteral">&quot;DUD00029&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        client.reqPnL(17001, <span class="stringliteral">&quot;DUD00029&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        client.reqPnL(17001, <span class="stringliteral">&quot;DUD00029&quot;</span>, <span class="stringliteral">&quot;&quot;</span>)</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    m_pClient-&gt;reqPnL(7001, <span class="stringliteral">&quot;DUD00029&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"></div><!-- fragment -->  </li>
</ul>
<ul>
<li>For FA accounts, if 'All' is specified as the accound code, aggregated data for all subaccounts is returned.</li>
<li>With requests for advisor accounts with many subaccounts and/or positions can take several seconds for aggregated P&amp;L to be computed and returned.</li>
<li>For account P&amp;L data the TWS setting "Prepare portfolio PnL data when downloading positions" must be checked.</li>
</ul>
<p>Updates are sent to <a class="el" href="interfaceIBApi_1_1EWrapper.html#ad19e3db5eaded96b4ed7aefe886d9d59" title="receives PnL updates in real time for the daily PnL and the total unrealized PnL for an account ...">IBApi.EWrapper.pnl</a></p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> pnl(<span class="keywordtype">int</span> reqId, <span class="keywordtype">double</span> dailyPnL, <span class="keywordtype">double</span> unrealizedPnL, <span class="keywordtype">double</span> realizedPnL)</div>
<div class="line">        {</div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;PnL. Request Id: {0}, Daily PnL: {1}, Unrealized PnL: {2}, Realized PnL: {3}&quot;</span>, reqId, dailyPnL, unrealizedPnL, realizedPnL);</div>
<div class="line">        }</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    @Override</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> pnl(<span class="keywordtype">int</span> reqId, <span class="keywordtype">double</span> dailyPnL, <span class="keywordtype">double</span> unrealizedPnL, <span class="keywordtype">double</span> realizedPnL) {</div>
<div class="line">        System.out.println(EWrapperMsgGenerator.pnl(reqId, dailyPnL, unrealizedPnL, realizedPnL));</div>
<div class="line">    }</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        Public Sub pnl(reqId As Integer, dailyPnL As Double, unrealizedPnL As Double, realizedPnL As Double) Implements EWrapper.pnl</div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;PnL. Request Id: {0}, daily PnL: {1}, unrealized PnL: {2}, realized PnL: {3}&quot;</span>, reqId, dailyPnL, unrealizedPnL, realizedPnL)</div>
<div class="line">        End Sub</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> TestCppClient::pnl(<span class="keywordtype">int</span> reqId, <span class="keywordtype">double</span> dailyPnL, <span class="keywordtype">double</span> unrealizedPnL, <span class="keywordtype">double</span> realizedPnL) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;PnL. ReqId: %d, daily PnL: %g, unrealized PnL: %g, realized PnL: %g\n&quot;</span>, reqId, dailyPnL, unrealizedPnL, realizedPnL);</div>
<div class="line">}</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"></div><!-- fragment -->  </li>
</ul>
<p>Cancel unnecessary subscriptions with the <a class="el" href="classIBApi_1_1EClient.html#a5a805731fedd8f40130a51a459328572" title="cancels subscription for real time updated daily PnL params reqId ">IBApi::EClient::cancelPnL</a> function:</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">            client.cancelPnL(17001);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        client.cancelPnL(17001);        </div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        client.cancelPnL(17001)</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    m_pClient-&gt;cancelPnL(7001);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"></div><!-- fragment -->  </li>
</ul>
<p><br/>
<br/>
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">This website uses cookies. By navigating through it you agree to the use of cookies. Copyright Interactive Brokers 2016 </li>
  </ul>
</div>
<!--BEGIN GCS_SEARCHBOX-->
<style type='text/css'>
	.gsc-control-cse{
		font family: Arial, sans-serif;
		border-color: #000100;
		background-color: #000000;
		width:260px;
		height: 20px;
		padding-top: 6px;
	}
	input.gsc-search-button {
		background-color: #6D1800;
		color: #fff;
		cursor: pointer;
	}
	input.gsc-search-button:hover {
		background-color: #A02200;
	}
	td.gsc-clear-button {
		position: relative;
		right: 85px;
	}
  }
</style>
<!--END GCS_SEARCHBOX-->
</body>
</html>
