<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>TWS API v9.72+: Receiving exchange components</title>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="https://www.interactivebrokers.com/favicon.ico" rel="shortcut icon">
<script>
$(document).ready(function(){
		var picked=getCookie("picked");
		if (picked != "") {
			if (!$(this).hasClass("active")) {
				var tabNum = $(this).index();
				var nthChild = picked;
				$("ul#tabs li.active").removeClass("active");
				$(this).addClass("active");
				$("ul#tab li.active").removeClass("active");
				$("ul#tab li:nth-child("+nthChild+")").addClass("active");
				$("ul#tabs li:nth-child("+nthChild+")").addClass("active");
				setCookie("picked", nthChild, 1);
			}
		}
		$("ul#tabs li").click(function(e){
			if (!$(this).hasClass("active")) {
			var tabNum = $(this).index();
			var nthChild = tabNum+1;
			$("ul#tabs li.active").removeClass("active");
			$(this).addClass("active");
			$("ul#tab li.active").removeClass("active");
			$("ul#tab li:nth-child("+nthChild+")").addClass("active");
			setCookie("picked", nthChild, 1);
		}
    });
});
function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires="+d.toUTCString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
} 
function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i=0; i<ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1);
        if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
    }
    return "";
} 
function checkCookie() {
    var picked=getCookie("picked");
    if (picked != "") {
        alert("Welcome again " + picked);
    }else{
        //username = prompt("Please enter your name:", "");
        if (picked != "" && picked != null) {
            setCookie("picked", 1, 365);
        }
    }
}
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ib_theme.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" style="background-color:black;">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr>
  <td id="projectlogo"><img alt="Logo" src="nav_iblogo.png"/></a></td>
  <td style="padding: 0 0 0 1em;">
   <ul id="tabs"><li class="active">C#</li><li>Java</li><li>VB</li><li>C++</li><li>Python</li></ul>
  </td>
  <td><a href="https://www.interactivebrokers.com/en/index.php?f=customerService&p=email" style="color:#C7C7C7;font-weight:bold;padding: 0 0 0 1em;">Contact us</a></td>
  <!--BEGIN GCS_SEARCHBOX-->
  <td style="position: absolute; right: 0;">
   <div id="google-custom-search" align="right" style="vertical-align: top;">
   <script>
  (function() {
    var cx = '002885114636493240026:q6smajphkxq';
	var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
	</script>
	<gcse:search newWindow="false" enableHistory="true"></gcse:search>
   </div>
   </td>
  <!--END !GCS_SEARCHBOX-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('smart_components.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Receiving exchange components </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A single data request from the API can receive aggregate quotes from multiple exchanges. With API versions 9.72.18 and TWS 9.62 and higher, the tick types 'bidExch' (tick type 32), 'askExch' (tick type 33), 'lastExch' (tick type 84) are used to identify the source of a quote. To preserve bandwidth, the data returned to these tick types consists of a sequence of capital letters rather than a long list of exchange names for every returned exchange name field. To find the full exchange name corresponding to a single letter code returned in tick types 32, 33, or 84, and API function <a class="el" href="classIBApi_1_1EClient.html#a3c656183f9a8d46349167cf2ebe9dfa2" title="Returns the mapping of single letter codes to exchange names given the mapping identifier. ">IBApi::EClient::reqSmartComponents</a> is available.</p>
<p>Different IB contracts have a different exchange map containing the set of exchanges on which they trade. Each exchange map has a different code, such as "a6" or "a9". This exchange mapping code is returned to <a class="el" href="interfaceIBApi_1_1EWrapper.html#acdc6b7acebacd83078af3b5c24f23b33" title="tick with BOO exchange and snapshot permissions ">IBApi::EWrapper::tickReqParams</a> immediately after a market data request is made by a user with market data subscriptions. To find a particular map of single letter codes to full exchange names, the function reqSmartComponents is invoked with the exchange mapping code returned to tickReqParams.</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">            client.reqSmartComponents(13002, testImpl.BboExchange);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        client.reqSmartComponents(1013, <span class="stringliteral">&quot;a6&quot;</span>);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        client.reqSmartComponents(13002, wrapperImpl.BboExchange)</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        m_pClient-&gt;reqSmartComponents(13002, m_bboExchange);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;    <span class="comment"># reqSmartComponents not yet available in Python</span></div>
</div><!-- fragment -->  </li>
</ul>
<p>For instance, a market data request for the IBKR US contract may return the exchange mapping identifier "a6" to tickReqParams. Invoking the function reqSmartComponents with the symbol "a9" will reveal the list of exchanges offering market data for the IBKR US contract, and their single letter codes. The code for "ARCA" may be "P". In that case if "P" is returned to the exchange tick types, that would indicate the quote was provided by ARCA.</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> smartComponents(<span class="keywordtype">int</span> reqId, Dictionary&lt;<span class="keywordtype">int</span>, KeyValuePair&lt;string, char&gt;&gt; theMap)</div>
<div class="line">        {</div>
<div class="line">            StringBuilder sb = <span class="keyword">new</span> StringBuilder();</div>
<div class="line"></div>
<div class="line">            sb.AppendFormat(<span class="stringliteral">&quot;==== Smart Components Begin (total={0}) reqId = {1} ====\n&quot;</span>, theMap.Count, reqId);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">foreach</span> (var item <span class="keywordflow">in</span> theMap)</div>
<div class="line">            {</div>
<div class="line">                sb.AppendFormat(<span class="stringliteral">&quot;bit number: {0}, exchange: {1}, exchange letter: {2}\n&quot;</span>, item.Key, item.Value.Key, item.Value.Value);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            sb.AppendFormat(<span class="stringliteral">&quot;==== Smart Components Begin (total={0}) reqId = {1} ====\n&quot;</span>, theMap.Count, reqId);</div>
<div class="line"></div>
<div class="line">            Console.WriteLine(sb);</div>
<div class="line">        }</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    @Override</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> smartComponents(<span class="keywordtype">int</span> reqId, Map&lt;Integer, SimpleEntry&lt;String, Character&gt;&gt; theMap) {</div>
<div class="line">        System.out.println(<span class="stringliteral">&quot;smart components req id:&quot;</span> + reqId);</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">for</span> (Map.Entry&lt;Integer, SimpleEntry&lt;String, Character&gt;&gt; item : theMap.entrySet()) {</div>
<div class="line">            System.out.println(<span class="stringliteral">&quot;bit number: &quot;</span> + item.getKey() + </div>
<div class="line">                    <span class="stringliteral">&quot;, exchange: &quot;</span> + item.getValue().getKey() + <span class="stringliteral">&quot;, exchange letter: &quot;</span> + item.getValue().getValue());            </div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        Public Sub smartComponents(reqId As Integer, theMap As Dictionary(Of Integer, KeyValuePair(Of String, Char))) Implements EWrapper.smartComponents</div>
<div class="line">            Dim sb As New StringBuilder</div>
<div class="line"></div>
<div class="line">            sb.AppendFormat(&quot;==== Smart Components Begin (total={0}) reqId = {1} ===={2}<span class="stringliteral">&quot;, theMap.Count, reqId, Environment.NewLine)</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">            For Each item In theMap</span></div>
<div class="line"><span class="stringliteral">                sb.AppendFormat(&quot;</span>bit number: {0}, exchange: {1}, exchange letter: {2}{3}<span class="stringliteral">&quot;, item.Key, item.Value.Key, item.Value.Value, Environment.NewLine)</span></div>
<div class="line"><span class="stringliteral">            Next</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">            sb.AppendFormat(&quot;</span>==== Smart Components Begin (total={0}) reqId = {1} ===={2}<span class="stringliteral">&quot;, theMap.Count, reqId, Environment.NewLine)</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">            Console.WriteLine(sb)</span></div>
<div class="line"><span class="stringliteral">        End Sub</span></div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> TestCppClient::smartComponents(<span class="keywordtype">int</span> reqId, SmartComponentsMap theMap) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Smart components: (%lu):\n&quot;</span>, theMap.size());</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (SmartComponentsMap::iterator i = theMap.begin(); i != theMap.end(); i++) {</div>
<div class="line">        printf(<span class="stringliteral">&quot; bit number: %d exchange: %s exchange letter: %c\n&quot;</span>, i-&gt;first, std::get&lt;0&gt;(i-&gt;second).c_str(), std::get&lt;1&gt;(i-&gt;second));</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;    <span class="comment"># smartComponents not yet available in Python</span></div>
</div><!-- fragment -->  </li>
</ul>
<p><br/>
<br/>
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">This website uses cookies. By navigating through it you agree to the use of cookies. Copyright Interactive Brokers 2016 </li>
  </ul>
</div>
<!--BEGIN GCS_SEARCHBOX-->
<style type='text/css'>
	.gsc-control-cse{
		font family: Arial, sans-serif;
		border-color: #000100;
		background-color: #000000;
		width:250px;
		height: 20px;
		padding-top: 6px;
	}
	input.gsc-search-button {
		background-color: #6D1800;
		color: #fff;
		cursor: pointer;
	}
	input.gsc-search-button:hover {
		background-color: #A02200;
	}
	td.gsc-clear-button {
		position: relative;
		right: 85px;
	}
  }
</style>
<!--END GCS_SEARCHBOX-->
</body>
</html>
