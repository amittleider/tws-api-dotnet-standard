<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>TWS API: Connection</title>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script>
$(document).ready(function(){
    $("ul#tabs li").click(function(e){
        if (!$(this).hasClass("active")) {
            var tabNum = $(this).index();
            var nthChild = tabNum+1;
            $("ul#tabs li.active").removeClass("active");
            $(this).addClass("active");
            $("ul#tab li.active").removeClass("active");
            $("ul#tab li:nth-child("+nthChild+")").addClass("active");
        }
    });
});
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="ib_theme.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" style="background-color:black;">
<table cellspacing="0" cellpadding="0" >
 <tbody>
 <tr>
  <td id="projectlogo"><img alt="Logo" src="nav_iblogo.png"/></td>
  <td style="padding: 0 0 0 1em;">
   <ul id="tabs"><li class="active">C#</li><li>Java</li><li>VB</li><li>C++</li></ul>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('connection.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Connection </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A TCP connection between your API client application and the TWS needs to be established via the IBApi::EClientSocket::eConnect function. The TWS can be considered like a server actively listening for incoming connection requests on a given port. Note that the TWS can accept up to 32 different client applications simultaneously each of them identified by a unique client Id. Before we can connect though, we need to follow a few simple steps.</p>
<h1><a class="anchor" id="ewrapper_impl"></a>
Implementing the EWrapper interface</h1>
<p>The <a class="el" href="interfaceIBApi_1_1EWrapper.html">IBApi.EWrapper</a> interface is the mechanism through which the TWS delivers information to the API client application. By implementing this interface the client application will be able to receive and handle the information coming from the TWS. For further information on how to implement interfaces, refer to your programming language's documentation.</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">    <span class="keyword">public</span> <span class="keyword">class </span>EWrapperImpl : EWrapper </div>
<div class="line">    {</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>EWrapperImpl <span class="keyword">implements</span> EWrapper {</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">Public Class EWrapperImpl</div>
<div class="line">    Implements EWrapper</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><span class="keyword">class </span>TestCppClient : <span class="keyword">public</span> EWrapper</div>
<div class="line">{</div>
</div><!-- fragment -->  </li>
</ul>
<h1><a class="anchor" id="client_socket"></a>
The EClientSocket class</h1>
<p>Just as the EWrapper implementing class receives information from the TWS, an <a class="el" href="classIBApi_1_1EClientSocket.html">IBApi.EClientSocket</a> object is used to send requests to the the TWS. Note this class requires an implementation of the <a class="el" href="interfaceIBApi_1_1EWrapper.html">IBApi.EWrapper</a> interface as part of its contructor parameters. Behind the curtains the <a class="el" href="classIBApi_1_1EClientSocket.html">IBApi.EClientSocket</a> requires this object to invoke the <a class="el" href="interfaceIBApi_1_1EWrapper.html">IBApi.EWrapper</a> interface methods after reading the incoming data from the TWS:</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">        EClientSocket clientSocket;</div>
<div class="line">        <span class="keyword">public</span> readonly EReaderSignal Signal;</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">        <span class="keyword">public</span> EWrapperImpl()</div>
<div class="line">        {</div>
<div class="line">            Signal = <span class="keyword">new</span> EReaderMonitorSignal();</div>
<div class="line">            clientSocket = <span class="keyword">new</span> EClientSocket(<span class="keyword">this</span>, Signal);</div>
<div class="line">        }</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    <span class="keyword">private</span> EReaderSignal readerSignal;</div>
<div class="line">    <span class="keyword">private</span> EClientSocket clientSocket;</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">    <span class="keyword">public</span> EWrapperImpl() {</div>
<div class="line">        readerSignal = <span class="keyword">new</span> EJavaSignal();</div>
<div class="line">        clientSocket = <span class="keyword">new</span> EClientSocket(<span class="keyword">this</span>, readerSignal);</div>
<div class="line">    }</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    Public eReaderSignal As EReaderSignal</div>
<div class="line">    Public socketClient As EClientSocket</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">    Sub New()</div>
<div class="line">        eReaderSignal = New EReaderMonitorSignal</div>
<div class="line">        socketClient = New EClientSocket(Me, eReaderSignal)</div>
<div class="line">    End Sub</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    EClientSocket * <span class="keyword">const</span> m_pClient;</div>
<div class="line">    EReaderOSSignal m_osSignal;</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">TestCppClient::TestCppClient() : </div>
<div class="line">      m_osSignal(2000)<span class="comment">//2-seconds timeout</span></div>
<div class="line">    , m_pClient(new EClientSocket(this, &amp;m_osSignal))</div>
<div class="line">    , m_state(ST_CONNECT)</div>
<div class="line">    , m_sleepDeadline(0)</div>
<div class="line">    , m_orderId(0)</div>
<div class="line">    , m_pReader(0)</div>
<div class="line">    , m_extraAuth(false)</div>
<div class="line">{</div>
<div class="line">}</div>
</div><!-- fragment -->  </li>
</ul>
<h1><a class="anchor" id="connect"></a>
Connecting</h1>
<p>Once our two main objects have been created, the client application can then connect via the <a class="el" href="classIBApi_1_1EClientSocket.html">IBApi.EClientSocket</a> object:</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">            clientSocket.eConnect(<span class="stringliteral">&quot;127.0.0.1&quot;</span>, 7496, 0, <span class="keyword">false</span>);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        m_client.eConnect(<span class="stringliteral">&quot;127.0.0.1&quot;</span>, 7496, 0, <span class="keyword">false</span>);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        socketClient.eConnect(<span class="stringliteral">&quot;127.0.0.1&quot;</span>, 7496, 0, False)</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        client.connect( host, port, clientId);</div>
</div><!-- fragment -->  </li>
</ul>
<h1><a class="anchor" id="ereader"></a>
Starting an EReader</h1>
<p>The final step on this procedure is to launch a new thread to consume the data sent by the TWS through the TCP socket:</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">            <span class="comment">//Create a reader to consume messages from the TWS. The EReader will consume the incoming messages and put them in a queue</span></div>
<div class="line">            var reader = <span class="keyword">new</span> EReader(clientSocket, readerSignal);</div>
<div class="line">            reader.Start();</div>
<div class="line">            <span class="comment">//Once the messages are in the queue, an additional thread need to fetch them</span></div>
<div class="line">            <span class="keyword">new</span> Thread(() =&gt; { <span class="keywordflow">while</span> (clientSocket.IsConnected()) { readerSignal.waitForSignal(); reader.processMsgs(); } }) { IsBackground = <span class="keyword">true</span> }.Start();</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        <span class="keyword">final</span> EReader reader = <span class="keyword">new</span> EReader(m_client, m_signal);        </div>
<div class="line">        reader.start();        </div>
<div class="line">        <span class="keyword">new</span> Thread() {</div>
<div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div>
<div class="line">                <span class="keywordflow">while</span> (m_client.isConnected()) {</div>
<div class="line">                    m_signal.waitForSignal();</div>
<div class="line">                    <span class="keywordflow">try</span> {</div>
<div class="line">                        reader.processMsgs();</div>
<div class="line">                    } <span class="keywordflow">catch</span> (Exception e) {</div>
<div class="line">                        System.out.println(<span class="stringliteral">&quot;Exception: &quot;</span>+e.getMessage());</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }.start();</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        Dim msgThread As Thread = New Thread(AddressOf messageProcessing)</div>
<div class="line">        msgThread.IsBackground = True</div>
<div class="line">        If (wrapperImpl.serverVersion() &gt; 0) Then Call msgThread.Start()</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">    Private Sub messageProcessing()</div>
<div class="line">        Dim reader As EReader = New EReader(wrapperImpl.socketClient, wrapperImpl.eReaderSignal)</div>
<div class="line">        reader.Start()</div>
<div class="line">        While (wrapperImpl.socketClient.IsConnected)</div>
<div class="line">            wrapperImpl.eReaderSignal.waitForSignal()</div>
<div class="line">            reader.processMsgs()</div>
<div class="line">        End While</div>
<div class="line">    End Sub</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        <span class="comment">//Unlike the C# and Java clients, there is no need to explicitely create an EReader object nor a thread</span></div>
<div class="line">        <span class="keywordflow">while</span>( client.isConnected()) {</div>
<div class="line">            client.processMessages();</div>
<div class="line">        }</div>
</div><!-- fragment -->  </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Copyright IB 2015 </li>
  </ul>
</div>
</body>
</html>
