<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>TWS API v9.72+: Historical Data</title>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="https://www.interactivebrokers.com/favicon.ico" rel="shortcut icon">
<script>
$(document).ready(function(){
		var picked=getCookie("picked");
		if (picked != "") {
			if (!$(this).hasClass("active")) {
				var tabNum = $(this).index();
				var nthChild = picked;
				$("ul#tabs li.active").removeClass("active");
				$(this).addClass("active");
				$("ul#tab li.active").removeClass("active");
				$("ul#tab li:nth-child("+nthChild+")").addClass("active");
				$("ul#tabs li:nth-child("+nthChild+")").addClass("active");
				setCookie("picked", nthChild, 1);
			}
		}
		$("ul#tabs li").click(function(e){
			if (!$(this).hasClass("active")) {
			var tabNum = $(this).index();
			var nthChild = tabNum+1;
			$("ul#tabs li.active").removeClass("active");
			$(this).addClass("active");
			$("ul#tab li.active").removeClass("active");
			$("ul#tab li:nth-child("+nthChild+")").addClass("active");
			setCookie("picked", nthChild, 1);
		}
    });
});
function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires="+d.toUTCString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
} 
function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i=0; i<ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1);
        if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
    }
    return "";
} 
function checkCookie() {
    var picked=getCookie("picked");
    if (picked != "") {
        alert("Welcome again " + picked);
    }else{
        //username = prompt("Please enter your name:", "");
        if (picked != "" && picked != null) {
            setCookie("picked", 1, 365);
        }
    }
}
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ib_theme.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" style="background-color:black;">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr>
  <td id="projectlogo"><img alt="Logo" src="nav_iblogo.png"/></a></td>
  <td style="padding: 0 0 0 1em;">
   <ul id="tabs"><li class="active">C#</li><li>Java</li><li>VB</li><li>C++</li><li>Python</li></ul>
  </td>
  <td><a href="https://www.interactivebrokers.com/en/index.php?f=customerService&p=email" style="color:#C7C7C7;font-weight:bold;padding: 0 0 0 1em;">Contact us</a></td>
  <!--BEGIN GCS_SEARCHBOX-->
  <td style="position: absolute; right: 0;">
   <div id="google-custom-search" align="right" style="vertical-align: top;">
   <script>
  (function() {
    var cx = '002885114636493240026:q6smajphkxq';
	var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
	</script>
	<gcse:search newWindow="false" enableHistory="true"></gcse:search>
   </div>
   </td>
  <!--END !GCS_SEARCHBOX-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('historical_data.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Historical Data </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>To receive historical data from the API a user must have level 1 market data subscriptions for that contract. The API historical data functionality simply pulls certain types of data from TWS charts, so if data is not available in a TWS chart it will also not be available from the API. TWS charts can be created for many types of instruments without market data subscriptions, but API historical data always requires that the <a class="el" href="market_data.html#market_subscriptions">Live Market Data</a> are met.</p>
<p>-For European stocks, a smart-routed historical data requests requires subscriptions to all available exchanges.</p>
<p>-Beginning with API v973.03 and TWS v965, the option to subscribe to historical data is available so that data is continually returned in real time as new bars are available. This is indicated by specifying <em><b>keepUpToDate</b></em> = True.</p>
<p>-When retrieving historical data from the TWS, be aware of the <a class="el" href="historical_limitations.html">Historical Data Limitations</a>.</p>
<h1><a class="anchor" id="hd_request"></a>
Requesting Historical Data</h1>
<p>Historical data is obtained from the the TWS via the <a class="el" href="classIBApi_1_1EClient.html#a5eac5b7908b62c224985cf8577a8350c">IBApi.EClient.reqHistoricalData</a> function. Every request needs:</p>
<ul>
<li><em><b>tickerId</b></em>, A unique identifier which will serve to identify the incoming data.</li>
<li><em><b>contract</b></em>, The <a class="el" href="classIBApi_1_1Contract.html">IBApi.Contract</a> you are interested in.</li>
<li><em><b>endDateTime</b></em>, The request's end date and time (empty string can be used to indicate current time).</li>
<li><em><b>durationString</b></em>, The amount of time (or <a class="el" href="historical_data.html#hd_duration">Valid Duration String units</a>) to go back from the request's given end date and time.</li>
<li><em><b>barSizeSetting</b></em>, The data's granularity or <a class="el" href="historical_data.html#hd_barsize">Valid Bar Sizes</a></li>
<li><em><b>whatToShow</b></em>, The type of data to retrieve. See <a class="el" href="historical_data.html#hd_what_to_show">Historical Data Types</a></li>
<li><em><b>useRTH</b></em>, Whether (1) or not (0) to retrieve data generated only within Regular Trading Hours (RTH)</li>
<li><em><b>formatDate</b></em>, The format in which the incoming bars' date should be presented. Note that for day bars, only yyyyMMdd format is available.</li>
<li><em><b>keepUpToDate</b></em>, Whether a subscription is made to return real time bars as they are available (True), or all data is returned on a one-time basis (False). <em>Available starting with API v973.03+ and TWS v965+</em>.</li>
</ul>
<p>For example, making a request with an end date and time of "20160127 23:59:59", a duration string of "3 D" and a bar size of "1 hour" will return three days worth of 1 hour bars data in which the most recent bar will be the closest possible to 20160127 23:59:59.</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">            String queryTime = DateTime.Now.AddMonths(-6).ToString(<span class="stringliteral">&quot;yyyyMMdd HH:mm:ss&quot;</span>);</div>
<div class="line">            client.reqHistoricalData(4001, ContractSamples.EurGbpFx(), queryTime, <span class="stringliteral">&quot;1 M&quot;</span>, <span class="stringliteral">&quot;1 day&quot;</span>, <span class="stringliteral">&quot;MIDPOINT&quot;</span>, 1, 1, <span class="keyword">false</span>, null);</div>
<div class="line">            client.reqHistoricalData(4002, ContractSamples.EuropeanStock(), queryTime, <span class="stringliteral">&quot;10 D&quot;</span>, <span class="stringliteral">&quot;1 min&quot;</span>, <span class="stringliteral">&quot;TRADES&quot;</span>, 1, 1, <span class="keyword">false</span>, null);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        Calendar cal = Calendar.getInstance();</div>
<div class="line">        cal.add(Calendar.MONTH, -6);</div>
<div class="line">        SimpleDateFormat form = <span class="keyword">new</span> SimpleDateFormat(<span class="stringliteral">&quot;yyyyMMdd HH:mm:ss&quot;</span>);</div>
<div class="line">        String formatted = form.format(cal.getTime());</div>
<div class="line">        client.reqHistoricalData(4001, ContractSamples.EurGbpFx(), formatted, <span class="stringliteral">&quot;1 M&quot;</span>, <span class="stringliteral">&quot;1 day&quot;</span>, <span class="stringliteral">&quot;MIDPOINT&quot;</span>, 1, 1, <span class="keyword">false</span>, null);</div>
<div class="line">        client.reqHistoricalData(4002, ContractSamples.EuropeanStock(), formatted, <span class="stringliteral">&quot;10 D&quot;</span>, <span class="stringliteral">&quot;1 min&quot;</span>, <span class="stringliteral">&quot;TRADES&quot;</span>, 1, 1, <span class="keyword">false</span>, null);</div>
<div class="line">        Thread.sleep(2000);</div>
<div class="line">        <span class="comment">/*** Canceling historical data requests ***/</span></div>
<div class="line">        client.cancelHistoricalData(4001);</div>
<div class="line">        client.cancelHistoricalData(4002);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        Dim queryTime As String = DateTime.Now.AddMonths(-6).ToString(<span class="stringliteral">&quot;yyyyMMdd HH:mm:ss&quot;</span>)</div>
<div class="line">        client.reqHistoricalData(4001, ContractSamples.EurGbpFx(), queryTime, <span class="stringliteral">&quot;1 M&quot;</span>, <span class="stringliteral">&quot;1 day&quot;</span>, <span class="stringliteral">&quot;MIDPOINT&quot;</span>, 1, 1, False, Nothing)</div>
<div class="line">        client.reqHistoricalData(4002, ContractSamples.EuropeanStock(), queryTime, <span class="stringliteral">&quot;10 D&quot;</span>, <span class="stringliteral">&quot;1 min&quot;</span>, <span class="stringliteral">&quot;TRADES&quot;</span>, 1, 1, False, Nothing)</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    std::time_t rawtime;</div>
<div class="line">    std::tm* timeinfo;</div>
<div class="line">    <span class="keywordtype">char</span> queryTime [80];</div>
<div class="line"></div>
<div class="line">    std::time(&amp;rawtime);</div>
<div class="line">    timeinfo = std::localtime(&amp;rawtime);</div>
<div class="line">    std::strftime(queryTime, 80, <span class="stringliteral">&quot;%Y%m%d %H:%M:%S&quot;</span>, timeinfo);</div>
<div class="line"></div>
<div class="line">    m_pClient-&gt;reqHistoricalData(4001, ContractSamples::EurGbpFx(), queryTime, <span class="stringliteral">&quot;1 M&quot;</span>, <span class="stringliteral">&quot;1 day&quot;</span>, <span class="stringliteral">&quot;MIDPOINT&quot;</span>, 1, 1, <span class="keyword">false</span>, TagValueListSPtr());</div>
<div class="line">    m_pClient-&gt;reqHistoricalData(4002, ContractSamples::EuropeanStock(), queryTime, <span class="stringliteral">&quot;10 D&quot;</span>, <span class="stringliteral">&quot;1 min&quot;</span>, <span class="stringliteral">&quot;TRADES&quot;</span>, 1, 1, <span class="keyword">false</span>, TagValueListSPtr());</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;        queryTime = (datetime.datetime.today() -</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;                     datetime.timedelta(days=180)).strftime(<span class="stringliteral">&quot;%Y%m%d %H:%M:%S&quot;</span>)</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;        <span class="comment"># String queryTime = DateTime.Now.AddMonths(-6).ToString(&quot;yyyyMMdd HH:mm:ss&quot;)</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;        self.reqHistoricalData(4101, ContractSamples.USStockAtSmart(), queryTime,</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;                               <span class="stringliteral">&quot;1 M&quot;</span>, <span class="stringliteral">&quot;1 day&quot;</span>, <span class="stringliteral">&quot;MIDPOINT&quot;</span>, 1, 1, [])</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        self.reqHistoricalData(4001, ContractSamples.EurGbpFx(), queryTime,</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;                               <span class="stringliteral">&quot;1 M&quot;</span>, <span class="stringliteral">&quot;1 day&quot;</span>, <span class="stringliteral">&quot;MIDPOINT&quot;</span>, 1, 1, [])</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        self.reqHistoricalData(4002, ContractSamples.EuropeanStock(), queryTime,</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;                               <span class="stringliteral">&quot;10 D&quot;</span>, <span class="stringliteral">&quot;1 min&quot;</span>, <span class="stringliteral">&quot;TRADES&quot;</span>, 1, 1, [])</div>
</div><!-- fragment -->  </li>
</ul>
<h1><a class="anchor" id="reqHeadTimeStamp"></a>
Earliest Available Data</h1>
<p>To find the earliest available data point for a given instrument and data type a function is in the API starting in v973.02 and v963 of TWS/IBG, <a class="el" href="classIBApi_1_1EClient.html#a059b5072d1e8e8e96394e53366eb81f3" title="Returns the timestamp of earliest available historical data for a contract and data type  tickerId - ...">IBApi::EClient::reqHeadTimestamp</a></p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">            client.reqHeadTimestamp(14001, ContractSamples.USStock(), <span class="stringliteral">&quot;TRADES&quot;</span>, 1, 1);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        client.reqHeadTimestamp(4003, ContractSamples.USStock(), <span class="stringliteral">&quot;TRADES&quot;</span>, 1, 1);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        client.reqHeadTimestamp(14001, ContractSamples.USStock(), <span class="stringliteral">&quot;TRADES&quot;</span>, 1, 1)</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    m_pClient-&gt;reqHeadTimestamp(14001, ContractSamples::EurGbpFx(), <span class="stringliteral">&quot;MIDPOINT&quot;</span>, 1, 1);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;        self.reqHeadTimeStamp(4103, ContractSamples.USStockAtSmart(), <span class="stringliteral">&quot;TRADES&quot;</span>, 0, 1)</div>
</div><!-- fragment -->  </li>
</ul>
<p>The resulting head timestamp is returned to the function <a class="el" href="interfaceIBApi_1_1EWrapper.html#a9d28aa8e55f93f2fc7699b952e2490e0">IBApi.EWrapper.headTimestamp</a></p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">    <span class="keyword">public</span> <span class="keyword">class </span>EWrapperImpl : EWrapper </div>
<div class="line">    {</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> headTimestamp(<span class="keywordtype">int</span> reqId, <span class="keywordtype">string</span> headTimestamp)</div>
<div class="line">        {</div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;Head time stamp. Request Id: {0}, Head time stamp: {1}&quot;</span>, reqId, headTimestamp);</div>
<div class="line">        }</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>EWrapperImpl <span class="keyword">implements</span> EWrapper {</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">    @Override</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> headTimestamp(<span class="keywordtype">int</span> reqId, String headTimestamp) {</div>
<div class="line">        System.out.println(<span class="stringliteral">&quot;Head timestamp. Req Id: &quot;</span> + reqId + <span class="stringliteral">&quot;, headTimestamp: &quot;</span> + headTimestamp);</div>
<div class="line">    }</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    Public Class EWrapperImpl</div>
<div class="line">        Implements EWrapper</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">        Public Sub headTimestamp(requestId As Integer, timeStamp As String) Implements IBApi.EWrapper.headTimestamp</div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;Head time stamp. Request Id: {0}, Head time stamp: {1}&quot;</span>, requestId, timeStamp)</div>
<div class="line">        End Sub</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><span class="keyword">class </span>TestCppClient : <span class="keyword">public</span> EWrapper</div>
<div class="line">{</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line"><span class="keywordtype">void</span> TestCppClient::headTimestamp(<span class="keywordtype">int</span> reqId, <span class="keyword">const</span> std::string&amp; headTimestamp) {</div>
<div class="line">    printf( <span class="stringliteral">&quot;Head time stamp. ReqId: %d - Head time stamp: %s,\n&quot;</span>, reqId, headTimestamp.c_str());</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">class </span>TestWrapper(wrapper.EWrapper):</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;    <span class="keyword">def </span>headTimestamp(self, reqId:int, headTimestamp:str):</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;        print(<span class="stringliteral">&quot;HeadTimestamp: &quot;</span>, reqId, <span class="stringliteral">&quot; &quot;</span>, headTimestamp)</div>
</div><!-- fragment -->  </li>
</ul>
<p>A reqHeadTimeStamp request can be cancelled with IBApi::EClient::cancelHeadTimestamp</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">            client.cancelHeadTimestamp(14001);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        client.cancelHeadTimestamp(4003);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        client.cancelHeadTimestamp(14001)</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    m_pClient-&gt;cancelHeadTimestamp(14001);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;        self.cancelHeadTimeStamp(4103)</div>
</div><!-- fragment -->  </li>
</ul>
<h1><a class="anchor" id="hd_receive"></a>
Receiving Historical Data</h1>
<p>The historical data will be delivered via the <a class="el" href="interfaceIBApi_1_1EWrapper.html#ac943e5b81f6de111ddf71a1f05ab6282" title="returns the requested historical data bars ">IBApi::EWrapper::historicalData</a> method in the form of <b>candlesticks</b>. If reqHistoricalData was invoked with <em><b>keepUpToDate = false</b></em>, once all candlesticks have been received the <a class="el" href="interfaceIBApi_1_1EWrapper.html#a715bb6750de66a0e072a910e697e20cf">IBApi.EWrapper.historicalDataEnd</a> marker will be sent. Otherwise bars will continue to be returned in real time to <a class="el" href="interfaceIBApi_1_1EWrapper.html#a8c168da3a812b667421bec4e6e2a5b2d" title="Receives bars in real time if keepUpToDate is set as True in reqHistoricalData. Similar to realTimeBa...">IBApi::EWrapper::historicalDataUpdate</a>. The keepUpToDate functionality can only be used with bar sizes 5 seconds or greater and requires the endDate is set as the empty string.</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">    <span class="keyword">public</span> <span class="keyword">class </span>EWrapperImpl : EWrapper </div>
<div class="line">    {</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> historicalData(<span class="keywordtype">int</span> reqId, Bar bar)</div>
<div class="line">        {</div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;HistoricalData. &quot;</span> + reqId + <span class="stringliteral">&quot; - Time: &quot;</span> + bar.Time + <span class="stringliteral">&quot;, Open: &quot;</span> + bar.Open + <span class="stringliteral">&quot;, High: &quot;</span> + bar.High + <span class="stringliteral">&quot;, Low: &quot;</span> + bar.Low + <span class="stringliteral">&quot;, Close: &quot;</span> + bar.Close + <span class="stringliteral">&quot;, Volume: &quot;</span> + bar.Volume + <span class="stringliteral">&quot;, Count: &quot;</span> + bar.Count + <span class="stringliteral">&quot;, WAP: &quot;</span> + bar.WAP);</div>
<div class="line">        }</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> historicalDataEnd(<span class="keywordtype">int</span> reqId, <span class="keywordtype">string</span> startDate, <span class="keywordtype">string</span> endDate)</div>
<div class="line">        {</div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;HistoricalDataEnd - &quot;</span>+reqId+<span class="stringliteral">&quot; from &quot;</span>+startDate+<span class="stringliteral">&quot; to &quot;</span>+endDate);</div>
<div class="line">        }</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>EWrapperImpl <span class="keyword">implements</span> EWrapper {</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">    @Override</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> historicalData(<span class="keywordtype">int</span> reqId, Bar bar) {</div>
<div class="line">        System.out.println(<span class="stringliteral">&quot;HistoricalData. &quot;</span>+reqId+<span class="stringliteral">&quot; - Date: &quot;</span>+bar.time()+<span class="stringliteral">&quot;, Open: &quot;</span>+bar.open()+<span class="stringliteral">&quot;, High: &quot;</span>+bar.high()+<span class="stringliteral">&quot;, Low: &quot;</span>+bar.low()+<span class="stringliteral">&quot;, Close: &quot;</span>+bar.close()+<span class="stringliteral">&quot;, Volume: &quot;</span>+bar.volume()+<span class="stringliteral">&quot;, Count: &quot;</span>+bar.count()+<span class="stringliteral">&quot;, WAP: &quot;</span>+bar.wap());</div>
<div class="line">    }</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">    @Override</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> historicalDataEnd(<span class="keywordtype">int</span> reqId, String startDateStr, String endDateStr) {</div>
<div class="line">        System.out.println(<span class="stringliteral">&quot;HistoricalDataEnd. &quot;</span>+reqId+<span class="stringliteral">&quot; - Start Date: &quot;</span>+startDateStr+<span class="stringliteral">&quot;, End Date: &quot;</span>+endDateStr);</div>
<div class="line">    }</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    Public Class EWrapperImpl</div>
<div class="line">        Implements EWrapper</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">        Public Sub historicalData(reqId As Integer, bar As Bar) Implements IBApi.EWrapper.historicalData, IBApi.EWrapper.historicalDataUpdate</div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;HistoricalData - ReqId [&quot;</span> &amp; reqId &amp; <span class="stringliteral">&quot;] Date [&quot;</span> &amp; bar.Time &amp; <span class="stringliteral">&quot;] Open [&quot;</span> &amp; bar.Open &amp; <span class="stringliteral">&quot;] High [&quot;</span> &amp;</div>
<div class="line">                          bar.High &amp; <span class="stringliteral">&quot;] Low [&quot;</span> &amp; bar.Low &amp; <span class="stringliteral">&quot;] Volume [&quot;</span> &amp; bar.Volume &amp; <span class="stringliteral">&quot;] Count [&quot;</span> &amp; bar.Count &amp; <span class="stringliteral">&quot;]&quot;</span>)</div>
<div class="line">        End Sub</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">        Public Sub historicalDataEnd(reqId As Integer, start As String, [end] As String) Implements IBApi.EWrapper.historicalDataEnd</div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;HistoricalDataEnd - ReqId [&quot;</span> &amp; reqId &amp; <span class="stringliteral">&quot;] Start [&quot;</span> &amp; start &amp; <span class="stringliteral">&quot;] End [&quot;</span> &amp; [end] &amp; <span class="stringliteral">&quot;]&quot;</span>)</div>
<div class="line">        End Sub</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><span class="keyword">class </span>TestCppClient : <span class="keyword">public</span> EWrapper</div>
<div class="line">{</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line"><span class="keywordtype">void</span> TestCppClient::historicalData(TickerId reqId, Bar bar) {</div>
<div class="line">    printf( <span class="stringliteral">&quot;HistoricalData. ReqId: %ld - Date: %s, Open: %g, High: %g, Low: %g, Close: %g, Volume: %d, Count: %d, WAP: %g\n&quot;</span>, reqId, bar.time.c_str(), bar.open, bar.high, bar.low, bar.close, bar.volume, bar.count, bar.wap);</div>
<div class="line">}</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line"><span class="keywordtype">void</span> TestCppClient::historicalDataEnd(<span class="keywordtype">int</span> reqId, std::string startDateStr, std::string endDateStr) { </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;HistoricalDataEnd. ReqId: &quot;</span> &lt;&lt; reqId &lt;&lt; <span class="stringliteral">&quot; - Start Date: &quot;</span> &lt;&lt; startDateStr &lt;&lt; <span class="stringliteral">&quot;, End Date: &quot;</span> &lt;&lt; endDateStr &lt;&lt; std::endl;   </div>
<div class="line">}</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">class </span>TestWrapper(wrapper.EWrapper):</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;    <span class="keyword">def </span>historicalData(self, reqId: TickerId, date: str, open: float, high: float,</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;                       low: float, close: float, volume: int, barCount: int,</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;                       WAP: float, hasGaps: int):</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;        super().historicalData(reqId, date, open, high, low, close, volume,</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;                               barCount, WAP, hasGaps)</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        print(<span class="stringliteral">&quot;HistoricalData. &quot;</span>, reqId, <span class="stringliteral">&quot; Date:&quot;</span>, date, <span class="stringliteral">&quot;Open:&quot;</span>, open,</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;              <span class="stringliteral">&quot;High:&quot;</span>, high, <span class="stringliteral">&quot;Low:&quot;</span>, low, <span class="stringliteral">&quot;Close:&quot;</span>, close, <span class="stringliteral">&quot;Volume:&quot;</span>, volume,</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;              <span class="stringliteral">&quot;Count:&quot;</span>, barCount, <span class="stringliteral">&quot;WAP:&quot;</span>, WAP, <span class="stringliteral">&quot;HasGaps:&quot;</span>, hasGaps)</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;    <span class="keyword">def </span>historicalDataEnd(self, reqId: int, start: str, end: str):</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;        super().historicalDataEnd(reqId, start, end)</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;        print(<span class="stringliteral">&quot;HistoricalDataEnd &quot;</span>, reqId, <span class="stringliteral">&quot;from&quot;</span>, start, <span class="stringliteral">&quot;to&quot;</span>, end)</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
</div><!-- fragment -->  </li>
</ul>
<p><br/>
</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> historicalDataUpdate(<span class="keywordtype">int</span> reqId, Bar bar)</div>
<div class="line">        {</div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;HistoricalDataUpdate. &quot;</span> + reqId + <span class="stringliteral">&quot; - Time: &quot;</span> + bar.Time + <span class="stringliteral">&quot;, Open: &quot;</span> + bar.Open + <span class="stringliteral">&quot;, High: &quot;</span> + bar.High + <span class="stringliteral">&quot;, Low: &quot;</span> + bar.Low + <span class="stringliteral">&quot;, Close: &quot;</span> + bar.Close + <span class="stringliteral">&quot;, Volume: &quot;</span> + bar.Volume + <span class="stringliteral">&quot;, Count: &quot;</span> + bar.Count + <span class="stringliteral">&quot;, WAP: &quot;</span> + bar.WAP);</div>
<div class="line">        }</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    @Override</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> historicalDataUpdate(<span class="keywordtype">int</span> reqId, Bar bar) {</div>
<div class="line">        System.out.println(<span class="stringliteral">&quot;HistoricalDataUpdate. &quot;</span>+reqId+<span class="stringliteral">&quot; - Date: &quot;</span>+bar.time()+<span class="stringliteral">&quot;, Open: &quot;</span>+bar.open()+<span class="stringliteral">&quot;, High: &quot;</span>+bar.high()+<span class="stringliteral">&quot;, Low: &quot;</span>+bar.low()+<span class="stringliteral">&quot;, Close: &quot;</span>+bar.close()+<span class="stringliteral">&quot;, Volume: &quot;</span>+bar.volume()+<span class="stringliteral">&quot;, Count: &quot;</span>+bar.count()+<span class="stringliteral">&quot;, WAP: &quot;</span>+bar.wap());</div>
<div class="line">    }</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"></div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> TestCppClient::historicalDataUpdate(TickerId reqId, Bar bar) { </div>
<div class="line">    printf( <span class="stringliteral">&quot;HistoricalDataUpdate. ReqId: %ld - Date: %s, Open: %g, High: %g, Low: %g, Close: %g, Volume: %d, Count: %d, WAP: %g\n&quot;</span>, reqId, bar.time.c_str(), bar.open, bar.high, bar.low, bar.close, bar.volume, bar.count, bar.wap);</div>
<div class="line">}</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"></div><!-- fragment -->  </li>
</ul>
<h1><a class="anchor" id="hd_duration"></a>
Valid Duration String units</h1>
<table class="doxtable">
<tr>
<th>Unit</th><th>Description </th></tr>
<tr>
<td>S</td><td>Seconds </td></tr>
<tr>
<td>D</td><td>Day </td></tr>
<tr>
<td>W</td><td>Week </td></tr>
<tr>
<td>M</td><td>Month </td></tr>
<tr>
<td>Y</td><td>Year </td></tr>
</table>
<h1><a class="anchor" id="hd_barsize"></a>
Valid Bar Sizes</h1>
<table class="doxtable">
<tr>
<th>Size </th></tr>
<tr>
<td>1 secs </td><td>5 secs </td><td>10 secs </td><td>15 secs </td><td>30 secs </td></tr>
<tr>
<td>1 min </td><td>2 mins </td><td>3 mins </td><td>5 mins </td><td>10 mins </td><td>15 mins </td><td>20 mins </td><td>30 mins </td></tr>
<tr>
<td>1 hour </td><td>2 hours </td><td>3 hours </td><td>4 hours </td><td>8 hours </td></tr>
<tr>
<td>1 day </td></tr>
<tr>
<td>1 week </td></tr>
<tr>
<td>1 month </td></tr>
</table>
<h1><a class="anchor" id="hd_what_to_show"></a>
Historical Data Types</h1>
<p><b>(whatToShow)</b></p>
<p>All different kinds of historical data are returned in the form of candlesticks and as such the values return represent the state of the market <b>during the period covered by the candlestick</b>. For instance, it might appear obvious but a TRADES day bar's 'close' value does <b>NOT</b> represent the product's closing price but rather the last traded price registered.</p>
<table class="doxtable">
<tr>
<th>Type</th><th>Open</th><th>High</th><th>Low</th><th>Close</th><th>Volume </th></tr>
<tr>
<td><b>TRADES</b></td><td>First traded price</td><td>Highest traded price</td><td>Lowest traded price</td><td>Last traded price</td><td>Total traded volume </td></tr>
<tr>
<td><b>MIDPOINT</b></td><td>Starting midpoint price</td><td>Highest midpoint price</td><td>Lowest midpoint price</td><td>Last midpoint price</td><td>N/A </td></tr>
<tr>
<td><b>BID</b></td><td>Starting bid price</td><td>Highest bid price</td><td>Lowest bid price</td><td>Last bid price</td><td>N/A </td></tr>
<tr>
<td><b>ASK</b></td><td>Starting ask price</td><td>Highest ask price</td><td>Lowest ask price</td><td>Last ask price</td><td>N/A </td></tr>
<tr>
<td><b>BID_ASK</b></td><td>Time average bid</td><td>Max Ask</td><td>Min Bid</td><td>Time average ask</td><td>N/A </td></tr>
<tr>
<td><b>HISTORICAL_VOLATILITY</b></td><td>Starting volatility</td><td>Highest volatility</td><td>Lowest volatility</td><td>Last volatility</td><td>N/A </td></tr>
<tr>
<td><b>OPTION_IMPLIED_VOLATILITY</b></td><td>Starting implied volatility</td><td>Highest implied volatility</td><td>Lowest implied volatility</td><td>Last implied volatility</td><td>N/A </td></tr>
<tr>
<td><b>REBATE_RATE</b></td><td>Starting rebate rate</td><td>Highest rebate rate</td><td>Lowest rebate rate</td><td>Last rebate rate</td><td>N/A </td></tr>
<tr>
<td><b>FEE_RATE</b></td><td>Starting fee rate</td><td>Highest fee rate</td><td>Lowest fee rate</td><td>Last fee rate</td><td>N/A </td></tr>
<tr>
<td><b>YIELD_BID</b></td><td>Starting bid yield</td><td>Highest bid yield</td><td>Lowest bid yield</td><td>Last bid yield </td><td>N/A </td></tr>
<tr>
<td><b>YIELD_ASK</b></td><td>Starting ask yield</td><td>Highest ask yield</td><td>Lowest ask yield</td><td>Last ask yield</td><td>N/A </td></tr>
<tr>
<td><b>YIELD_BID_ASK</b></td><td>Time average bid yield</td><td>Highest ask yield</td><td>Lowest bid yield</td><td>Time average ask yield</td><td>N/A </td></tr>
<tr>
<td><b>YIELD_LAST</b></td><td>Starting last yield</td><td>Highest last yield</td><td>Lowest last yield</td><td>Last last yield</td><td><p class="starttd">N/A</p>
<p class="endtd"></p>
</td></tr>
</table>
<p><br/>
</p>
<h1><a class="anchor" id="available_products_hd"></a>
Available Data per Product</h1>
<table class="doxtable">
<tr>
<th><center>Product Type</center></th><th><center>TRADES</center></th><th><center>MIDPOINT</center></th><th><center>BID</center></th><th><center>ASK</center></th><th><center>BID_ASK</center></th><th><center>HISTORICAL_VOLATILITY</center></th><th><center>OPTION_IMPLIED_VOLATILITY</center></th><th><center>YIELD_BID</center></th><th><center>YIELD_ASK</center></th><th><center>YIELD_BID_ASK</center></th><th><center>YIELD_LAST </center></th></tr>
<tr>
<td><center>Stocks</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N </center></td></tr>
<tr>
<td><center>Commodities</center></td><td><center>N</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N </center></td></tr>
<tr>
<td><center>Options</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N </center></td></tr>
<tr>
<td><center>Futures</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N </center></td></tr>
<tr>
<td><center>FOPs</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N </center></td></tr>
<tr>
<td><center>ETFs</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N </center></td></tr>
<tr>
<td><center>Warrants</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N </center></td></tr>
<tr>
<td><center>Structured Products</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N </center></td></tr>
<tr>
<td><center>SSFs</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N </center></td></tr>
<tr>
<td><center>Forex</center></td><td><center>N</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N </center></td></tr>
<tr>
<td><center>Metals</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N </center></td></tr>
<tr>
<td><center>Indices</center></td><td><center>Y</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N </center></td></tr>
<tr>
<td><center>Bonds*</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>N</center></td><td><center>N</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y </center></td></tr>
<tr>
<td><center>Funds</center></td><td><center>N</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N </center></td></tr>
<tr>
<td><center>CFDs*</center></td><td><center>N</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>Y</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center></td><td><center>N</center> </td></tr>
</table>
<p>-Yield historical data only available for corporate bonds</p>
<h1><a class="anchor" id="histogramdata"></a>
Requesting Histograms</h1>
<p><a class="el" href="histograms.html">Histograms</a></p>
<p><br/>
<br/>
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">This website uses cookies. By navigating through it you agree to the use of cookies. Copyright Interactive Brokers 2016 </li>
  </ul>
</div>
<!--BEGIN GCS_SEARCHBOX-->
<style type='text/css'>
	.gsc-control-cse{
		font family: Arial, sans-serif;
		border-color: #000100;
		background-color: #000000;
		width:250px;
		height: 20px;
		padding-top: 6px;
	}
	input.gsc-search-button {
		background-color: #6D1800;
		color: #fff;
		cursor: pointer;
	}
	input.gsc-search-button:hover {
		background-color: #A02200;
	}
	td.gsc-clear-button {
		position: relative;
		right: 85px;
	}
  }
</style>
<!--END GCS_SEARCHBOX-->
</body>
</html>
