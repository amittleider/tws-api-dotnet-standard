<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>TWS API v9.72+: Requesting Market Data</title>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="https://www.interactivebrokers.com/favicon.ico" rel="shortcut icon">
<script>
$(document).ready(function(){
		var picked=getCookie("picked");
		if (picked != "") {
			if (!$(this).hasClass("active")) {
				var tabNum = $(this).index();
				var nthChild = picked;
				$("ul#tabs li.active").removeClass("active");
				$(this).addClass("active");
				$("ul#tab li.active").removeClass("active");
				$("ul#tab li:nth-child("+nthChild+")").addClass("active");
				$("ul#tabs li:nth-child("+nthChild+")").addClass("active");
				setCookie("picked", nthChild, 1);
			}
		}
		$("ul#tabs li").click(function(e){
			if (!$(this).hasClass("active")) {
			var tabNum = $(this).index();
			var nthChild = tabNum+1;
			$("ul#tabs li.active").removeClass("active");
			$(this).addClass("active");
			$("ul#tab li.active").removeClass("active");
			$("ul#tab li:nth-child("+nthChild+")").addClass("active");
			setCookie("picked", nthChild, 1);
		}
    });
});
function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires="+d.toUTCString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
} 
function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i=0; i<ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1);
        if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
    }
    return "";
} 
function checkCookie() {
    var picked=getCookie("picked");
    if (picked != "") {
        alert("Welcome again " + picked);
    }else{
        //username = prompt("Please enter your name:", "");
        if (picked != "" && picked != null) {
            setCookie("picked", 1, 365);
        }
    }
}
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ib_theme.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" style="background-color:black;">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr>
  <td id="projectlogo"><img alt="Logo" src="nav_iblogo.png"/></a></td>
  <td style="padding: 0 0 0 1em;">
   <ul id="tabs"><li class="active">C#</li><li>Java</li><li>VB</li><li>C++</li><li>Python</li></ul>
  </td>
  <td><a href="https://www.interactivebrokers.com/en/index.php?f=customerService&p=email" style="color:#C7C7C7;font-weight:bold;padding: 0 0 0 1em;">Contact us</a></td>
  <!--BEGIN GCS_SEARCHBOX-->
  <td style="position: absolute; right: 0;">
   <div id="google-custom-search" align="right" style="vertical-align: top;">
   <script>
  (function() {
    var cx = '002885114636493240026:q6smajphkxq';
	var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
	</script>
	<gcse:search newWindow="false" enableHistory="true"></gcse:search>
   </div>
   </td>
  <!--END !GCS_SEARCHBOX-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_request.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Requesting Market Data </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In order to receive live quotes, you must first make the request call via <a class="el" href="classIBApi_1_1EClient.html#a7a19258a3a2087c07c1c57b93f659b63">IBApi.EClient.reqMktData</a> within your API program. Every request needs a unique identifier which will serve to identify the returned data:</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">            client.reqMktData(16001, ContractSamples.USStockCFD(), <span class="keywordtype">string</span>.Empty, <span class="keyword">false</span>, <span class="keyword">false</span>, null);</div>
<div class="line">            Thread.Sleep(1000);</div>
<div class="line">            client.reqMktData(16002, ContractSamples.EuropeanStockCFD(), <span class="keywordtype">string</span>.Empty, <span class="keyword">false</span>, <span class="keyword">false</span>, null);</div>
<div class="line">            Thread.Sleep(1000);</div>
<div class="line">            client.reqMktData(16003, ContractSamples.CashCFD(), <span class="keywordtype">string</span>.Empty, <span class="keyword">false</span>, <span class="keyword">false</span>, null);</div>
<div class="line">            Thread.Sleep(1000);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        client.reqMktData(1001, ContractSamples.StockComboContract(), <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, null);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        client.reqMktData(1001, ContractSamples.StockComboContract(), String.Empty, False, False, Nothing)</div>
<div class="line">        client.reqMktData(1002, ContractSamples.FuturesOnOptions(), String.Empty, False, False, Nothing)</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    m_pClient-&gt;reqMktData(1001, ContractSamples::StockComboContract(), <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, TagValueListSPtr());</div>
<div class="line">    m_pClient-&gt;reqMktData(1002, ContractSamples::OptionWithLocalSymbol(), <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, TagValueListSPtr());</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;        self.reqMktData(1101, ContractSamples.USStockAtSmart(), <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">False</span>, <span class="keyword">False</span>, [])</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;        self.reqMktData(1001, ContractSamples.StockComboContract(), <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">True</span>, <span class="keyword">False</span>, [])</div>
</div><!-- fragment -->  </li>
</ul>
<h1><a class="anchor" id="genticks"></a>
Generic Tick Types</h1>
<p>The most common tick types are delivered automatically after a successful market data request. There are however other tick types available by explicit request: the generic tick types. When invoking <a class="el" href="classIBApi_1_1EClient.html#a7a19258a3a2087c07c1c57b93f659b63">IBApi.EClient.reqMktData</a>, specific generic ticks can be requested via the <b>genericTickList</b> parameter of the function:</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">            <span class="comment">//Requesting RTVolume (Time &amp; Sales), shortable and Fundamental Ratios generic ticks</span></div>
<div class="line">            client.reqMktData(1004, ContractSamples.USStock(), <span class="stringliteral">&quot;233,236,258&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, null);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        <span class="comment">//Requesting RTVolume (Time &amp; Sales), shortable and Fundamental Ratios generic ticks</span></div>
<div class="line">        client.reqMktData(1004, ContractSamples.USStock(), <span class="stringliteral">&quot;233,236,258&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, null);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        <span class="stringliteral">&#39;Requesting RTVolume (Time &amp; Sales), shortable And Fundamental Ratios generic ticks</span></div>
<div class="line"><span class="stringliteral">        client.reqMktData(1004, ContractSamples.USStock(), &quot;233,236,258&quot;, False, False, Nothing)</span></div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    <span class="comment">//Requesting RTVolume (Time &amp; Sales), shortable and Fundamental Ratios generic ticks</span></div>
<div class="line">    m_pClient-&gt;reqMktData(1004, ContractSamples::USStock(), <span class="stringliteral">&quot;233,236,258&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, TagValueListSPtr());</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;        <span class="comment"># Requesting RTVolume (Time &amp; Sales), shortable and Fundamental Ratios generic ticks</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;        self.reqMktData(1004, ContractSamples.USStock(), <span class="stringliteral">&quot;233,236,258&quot;</span>, <span class="keyword">False</span>, <span class="keyword">False</span>, [])</div>
</div><!-- fragment -->  </li>
</ul>
<p>For a list of available tick types please refer to <a class="el" href="tick_types.html">Available Tick Types</a></p>
<h1><a class="anchor" id="md_snapshot"></a>
Streaming Data Snapshots</h1>
<p>With an exchange market data subscription, such as Network A (NYSE), Network B(ARCA), or Network C(NASDAQ) for US stocks, it is possible to request a snapshot of the current state of the market once instead of requesting a stream of updates continuously as market values change. By invoking the <a class="el" href="classIBApi_1_1EClient.html#a7a19258a3a2087c07c1c57b93f659b63" title="Requests real time market data. This function will return the product&#39;s market data. It is important to notice that only real time data can be delivered via the API. ">IBApi::EClient::reqMktData</a> function passing in <b>true</b> for the snapshot parameter, the client application will receive the currently available market data once before a <a class="el" href="interfaceIBApi_1_1EWrapper.html#a2d1c80705657202c82a0b8708ad0e169">IBApi.EWrapper.tickSnapshotEnd</a> event is sent 11 seconds later. Snapshot requests can only be made for the default tick types; no generic ticks can be specified. It is important to note that a snapshot request will only return available data over the 11 second span; in many cases values for all default ticks will not be returned. However snapshots are allowed a higher rate limit than the normal 50 messages per second limitation of other EClientSocket functions. </p>
<h4>Snapshot request:</h4>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">            client.reqMktData(1003, ContractSamples.FutureComboContract(), <span class="keywordtype">string</span>.Empty, <span class="keyword">true</span>, <span class="keyword">false</span>, null);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        client.reqMktData(1003, ContractSamples.FutureComboContract(), <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, null);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        client.reqMktData(1003, ContractSamples.FutureComboContract(), String.Empty, True, False, Nothing)</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    m_pClient-&gt;reqMktData(1003, ContractSamples::FutureComboContract(), <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, TagValueListSPtr());</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;        self.reqMktData(1003, ContractSamples.FutureComboContract(), <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">False</span>, <span class="keyword">False</span>, [])</div>
</div><!-- fragment -->  </li>
</ul>
<h4>End marker reception:</h4>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">    <span class="keyword">public</span> <span class="keyword">class </span>EWrapperImpl : EWrapper </div>
<div class="line">    {</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> tickSnapshotEnd(<span class="keywordtype">int</span> tickerId)</div>
<div class="line">        {</div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;TickSnapshotEnd: &quot;</span>+tickerId);</div>
<div class="line">        }</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>EWrapperImpl <span class="keyword">implements</span> EWrapper {</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">    @Override</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> tickSnapshotEnd(<span class="keywordtype">int</span> reqId) {</div>
<div class="line">        System.out.println(<span class="stringliteral">&quot;TickSnapshotEnd: &quot;</span>+reqId);</div>
<div class="line">    }</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    Public Class EWrapperImpl</div>
<div class="line">        Implements EWrapper</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">        Public Sub tickSnapshotEnd(tickerId As Integer) Implements IBApi.EWrapper.tickSnapshotEnd</div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;TickSnapshotEnd: &quot;</span> &amp; CStr(tickerId))</div>
<div class="line">        End Sub</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><span class="keyword">class </span>TestCppClient : <span class="keyword">public</span> EWrapper</div>
<div class="line">{</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line"><span class="keywordtype">void</span> TestCppClient::tickSnapshotEnd(<span class="keywordtype">int</span> reqId) {</div>
<div class="line">    printf( <span class="stringliteral">&quot;TickSnapshotEnd: %d\n&quot;</span>, reqId);</div>
<div class="line">}</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">class </span>TestWrapper(wrapper.EWrapper):</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;    <span class="keyword">def </span>tickSnapshotEnd(self, reqId: int):</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;        super().tickSnapshotEnd(reqId)</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;        print(<span class="stringliteral">&quot;TickSnapshotEnd:&quot;</span>, reqId)</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
</div><!-- fragment -->  </li>
</ul>
<h1><a class="anchor" id="regulatory_snapshot"></a>
Regulatory Snapshots</h1>
<p>The fifth argument to reqMktData specifies a regulatory snapshot request to US stocks and options. Regulatory snapshots require TWS/IBG <b>v963</b> and API <b>973.02</b> or higher and specific market data subscriptions.</p>
<p>For stocks, there are individual exchange-specific market data subscriptions necessary to receive streaming quotes. For instance, for NYSE stocks this subscription is known as "Network A", for ARCA/AMEX stocks it is called "Network B" and for NASDAQ stocks it is "Network C". Each subscription is added a la carte and has a separate market data fee.</p>
<p>Alternatively, there is also a "US Securities Snapshot Bundle" subscription which does not provide streaming data but which allows for real time calculated snapshots of US market NBBO prices. By setting the 5th parameter in the function <a class="el" href="classIBApi_1_1EClient.html#a7a19258a3a2087c07c1c57b93f659b63" title="Requests real time market data. This function will return the product&#39;s market data. It is important to notice that only real time data can be delivered via the API. ">IBApi::EClient::reqMktData</a> to <b>True</b>, a regulatory snapshot request can be made from the API. The returned value is a calculation of the current market state based on data from all available exchanges.</p>
<p><b>Important: Each regulatory snapshot made will incur a fee of 0.01 USD to the account. This applies to both live <em>and</em> paper accounts.</b>. If the monthly fee for regulatory snapshots reaches the price of a particular 'Network' subscription, the user will automatically be subscribed to that Network subscription for continuous streaming quotes and charged the associated fee for that month. At the end of the month the subscription will be terminated. Each listing exchange will be capped independently and will not be combined across listing exchanges.</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">            <span class="comment">// Each regulatory snapshot incurs a 0.01 USD fee</span></div>
<div class="line">            client.reqMktData(1005, ContractSamples.USStock(), <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, null);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        <span class="comment">// Each regulatory snapshot request incurs a 0.01 USD fee</span></div>
<div class="line">        client.reqMktData(1014, ContractSamples.USStock(), <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, null);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">        <span class="stringliteral">&#39; Each regulatory snapshot request will incur a fee of 0.01 USD </span></div>
<div class="line"><span class="stringliteral">        &#39;</span> client.reqMktData(1004, ContractSamples.USStock(), <span class="stringliteral">&quot;&quot;</span>, False, True, Nothing)</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    <span class="comment">// Each regulatory snapshot incurs a fee of 0.01 USD</span></div>
<div class="line">    m_pClient-&gt;reqMktData(1013, ContractSamples::USStock(), <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, TagValueListSPtr());</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;        <span class="comment"># Each regulatory snapshot request incurs a 0.01 USD fee</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;        <span class="comment"># self.reqMktData(1014, ContractSamples.USStock(), &quot;&quot;, False, True, [])</span></div>
</div><!-- fragment -->  </li>
</ul>
<p>The following table lists the cost and maximum allocation for regulatory snapshot quotes:</p>
<table class="doxtable">
<tr>
<th>Listed Network Feed</th><th>Price per reqSnapshot request</th><th>Pro or non-Pro</th><th>Max reqSnapshot request </th></tr>
<tr>
<td><center>NYSE (Network A/CTA)</center></td><td><center>0.01 USD</center></td><td><center>Pro</center></td><td><center>4500 </center></td></tr>
<tr>
<td><center>NYSE (Network A/CTA)</center></td><td><center>0.01 USD</center></td><td><center>Non-Pro</center></td><td><center>150 </center></td></tr>
<tr>
<td><center>AMEX (Network B/CTA)</center></td><td><center>0.01 USD</center></td><td><center>Pro</center></td><td><center>2300 </center></td></tr>
<tr>
<td><center>AMEX (Network B/CTA)</center></td><td><center>0.01 USD</center></td><td><center>Non-Pro</center></td><td><center>150 </center></td></tr>
<tr>
<td><center>NASDAQ (Network C/UTP)</center></td><td><center>0.01 USD</center></td><td><center>Pro</center></td><td><center>2300 </center></td></tr>
<tr>
<td><center>NASDAQ (Network C/UTP)</center></td><td><center>0.01 USD</center></td><td><center>Non-Pro</center></td><td><center>150</center> </td></tr>
</table>
<p>Requesting regulatory snapshots is subject to pacing limitations:</p>
<ul>
<li>If markets are closed, no more than two requests can be made in a 5 second period.</li>
<li>If markets are open, there can be no more than 5 requests pending for the same contract.</li>
</ul>
<p><br/>
<br/>
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">This website uses cookies. By navigating through it you agree to the use of cookies. Copyright Interactive Brokers 2016 </li>
  </ul>
</div>
<!--BEGIN GCS_SEARCHBOX-->
<style type='text/css'>
	.gsc-control-cse{
		font family: Arial, sans-serif;
		border-color: #000100;
		background-color: #000000;
		width:260px;
		height: 20px;
		padding-top: 6px;
	}
	input.gsc-search-button {
		background-color: #6D1800;
		color: #fff;
		cursor: pointer;
	}
	input.gsc-search-button:hover {
		background-color: #A02200;
	}
	td.gsc-clear-button {
		position: relative;
		right: 85px;
	}
  }
</style>
<!--END GCS_SEARCHBOX-->
</body>
</html>
